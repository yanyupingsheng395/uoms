<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="edge"/>
    <title>企业微信</title>
    <th:block th:include="common/include::common-css"/>
    <th:block th:include="common/include::bootstrap-table-css"/>
    <th:block th:include="common/include::jquery-confirm-css"/>
    <th:block th:include="common/include::bootstrap-year-calendar-css"/>
    <th:block th:include="common/include::datepicker-css"/>
    <style>
        .send {
            position: absolute;
            max-width: 250px;
            width: auto;
            height: auto;
            background: #fff;
            border-radius: 5px; /* 圆角 */
            margin-top: 30px;
            margin-left: 20px;
            padding: 10px;
            font-size: 12px;
            color: #000;
            word-wrap: break-word;
            text-align: left;
        }

        .send .arrow {
            position: absolute;
            top: 9px;
            left: -16px; /* 圆角的位置需要细心调试哦 */
            width: 0;
            height: 0;
            font-size: 0;
            border: solid 8px;
            border-color: rgb(235, 235, 235) #fff rgb(235, 235, 235) rgb(235, 235, 235);
        }
    </style>
</head>

<body class="gray-bg">
<div class="lyear-layout-web">
    <div class="lyear-layout-container">
        <!-- 左侧导航 -->
        <div data-th-include="common/aside"></div>
        <!-- 头部信息 -->
        <div data-th-include="common/header"></div>
        <!-- 页面主要内容 -->
        <main class="lyear-layout-content">
            <div class="container-div ui-layout-center">
                <div class="row">
                    <div class="col-sm-12 search-collapse">
                        <div class="row">
                            <h5 class="navbar-page-title">编辑欢迎语</h5>
                        </div>
                    </div>
                    <div class="col-md-12 select-table table-striped">
                        <div class="row m-t-10">
                            <div class="col-md-6">
                                <form class="form-horizontal" id="welcomeFormData">
                                    <input type="hidden" th:value="${welcome.id}" name="id"/>
                                    <div class="form-group">
                                        <label class="col-xs-12" style="font-weight: bold;">欢迎语名称</label>
                                        <div class="col-xs-12">
                                            <input class="form-control" type="text" name="welcomeName" th:value="${welcome.welcomeName}"/>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-xs-12" style="font-weight: bold;">欢迎语配置策略</label>
                                        <div class="col-xs-12">
                                            <label class="radio-inline">
                                                <input type="radio" name="policyType" th:checked="${welcome.policyType eq 'M'} ? true:false" value="M" onclick="policyClick()" checked="checked">
                                                自定义
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="policyType" th:checked="${welcome.policyType eq 'M'} ? false:true" value="A" onclick="policyClick()">
                                                智能策略
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-group" id="intelPolicy" th:if="!${welcome.policyType eq 'M'}">
                                        <label class="col-xs-12" style="font-weight: bold;">智能策略配置方案</label>
                                        <div class="col-xs-12">
                                            <label class="radio-inline">
                                                <input type="radio" name="policyTypeTmp" value="COUPON" th:checked="${welcome.policyType eq 'COUPON'} ? true:false">
                                                派发领券页
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="policyTypeTmp" value="PRODUCT" th:checked="${welcome.policyType eq 'PRODUCT'} ? true:false">
                                                派发商品页
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-group" id="intelPolicy" th:if="${welcome.policyType eq 'M'}" style="display: none;">
                                        <label class="col-xs-12" style="font-weight: bold;">智能策略配置方案</label>
                                        <div class="col-xs-12">
                                            <label class="radio-inline">
                                                <input type="radio" name="policyTypeTmp" value="COUPON" th:checked="${welcome.policyType eq 'COUPON'} ? true:false">
                                                派发领券页
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" name="policyTypeTmp" value="PRODUCT" th:checked="${welcome.policyType eq 'PRODUCT'} ? true:false">
                                                派发商品页
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-xs-12" style="font-weight: bold;">欢迎语素材</label>
                                        <div class="col-md-12">
                                            <ul id="myTabs" class="nav nav-tabs" role="tablist">
                                                <li class="active"><a href="#text" id="text-tab" role="tab"
                                                                      data-toggle="tab"><i class="fa fa-file-text-o"></i>&nbsp;文本</a>
                                                </li>
                                                <li><a href="#image" id="image-tab" role="tab"
                                                                      data-toggle="tab"><i class="fa fa-image"></i>&nbsp;图片</a>
                                                </li>
                                                <li><a href="#web" id="web-tab" role="tab"
                                                       data-toggle="tab"><i class="fa fa-link"></i>&nbsp;网页</a>
                                                </li>
                                                <li><a href="#miniprogram" id="miniprogram-tab" role="tab"
                                                       data-toggle="tab"><i class="fa fa-skyatlas"></i>&nbsp;小程序</a>
                                                </li>
                                            </ul>
                                            <div id="myTabContent" class="tab-content"
                                                 style="height: auto;border: solid 1px #ebebeb;padding: 10px;">
                                                <!--文本-->
                                                <div class="tab-pane fade active in" id="text">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <textarea th:text="${welcome.content}" class="form-control" name="content" rows="6" placeholder="请输入欢迎语内容" id="textContent1"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--图片-->
                                                <div class="tab-pane fade" id="image">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="form-horizontal">
                                                                <div class="form-group" style="margin-bottom: 2px;">
                                                                    <label class="col-md-3 control-label">图片地址：</label>
                                                                    <div class="col-md-7">
                                                                        <input class="form-control" th:value="${welcome.picUrl}" name="picUrl"/>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="tab-pane fade" id="web">
                                                    <div class="form-horizontal">
                                                        <div class="form-group">
                                                            <label class="col-md-3 control-label">消息标题：</label>
                                                            <div class="col-md-7">
                                                                <input class="form-control" name="linkTitle" th:value="${welcome.linkTitle}">
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-md-3 control-label">消息描述：</label>
                                                            <div class="col-md-7">
                                                                <input class="form-control" name="linkDesc" th:value="${welcome.linkDesc}">
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-md-3 control-label">消息地址：</label>
                                                            <div class="col-md-7">
                                                                <input class="form-control" name="linkUrl" th:value="${welcome.linkUrl}">
                                                            </div>
                                                        </div>
                                                        <div class="form-group" style="margin-bottom: 2px;">
                                                            <label class="col-md-3 control-label">封面地址：</label>
                                                            <div class="col-md-7">
                                                                <input class="form-control" name="linkPicurl" th:value="${welcome.linkPicurl}">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="tab-pane fade" id="miniprogram">
                                                    <div class="form-horizontal">
                                                        <div class="form-group">
                                                            <label class="col-md-3 control-label">小程序标题：</label>
                                                            <div class="col-md-7">
                                                                <input class="form-control" name="miniprogramTitle" th:value="${welcome.miniprogramTitle}">
                                                            </div>
                                                        </div>
                                                        <div class="form-group" style="margin-bottom: 2px;">
                                                            <label class="col-md-3 control-label">小程序地址：</label>
                                                            <div class="col-md-7">
                                                                <input class="form-control" name="miniprogramPage" th:value="${welcome.miniprogramPage}">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <ul style="color: #666; font-size: 12px;">
                                                <li><i class="fa fa-angle-double-right"></i>&nbsp;文本、图片、网页和小程序四者不能同时为空；</li>
                                                <li><i class="fa fa-angle-double-right"></i>&nbsp;文本与另外三者可以同时发送，此时将会以两条消息的形式触达客户</li>
                                                <li><i class="fa fa-angle-double-right"></i>&nbsp;图片、网页和小程序只能有一个，如果三者同时填，则按图片、网页、小程序的优先顺序取参，也就是说，如果图片和网页同时传值，则只有图片生效。</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-xs-12 text-center">
                                            <button class="btn btn-primary btn-sm" type="button" onclick="saveData(this)" name='update'><i
                                                    class="fa fa-save"></i>&nbsp;更新
                                            </button>
                                            <button th:if="!${welcome.policyType eq 'M'}" class="btn btn-primary btn-sm" type="button" onclick="getViewData()" id="configBtn"><i
                                                    class="fa fa-cog"></i>&nbsp;去配置
                                            </button>
                                            <button th:if="${welcome.policyType eq 'M'}" class="btn btn-primary btn-sm" type="button" onclick="getViewData()" id="configBtn" style="display: none;"><i
                                                    class="fa fa-cog"></i>&nbsp;去配置
                                            </button>
                                            <button class="btn btn-secondary btn-sm" type="button"
                                                    onclick="window.location.href='/page/qywxWelcome'"><i
                                                    class="fa fa-reply"></i>&nbsp;返回
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="col-md-6" style="margin-top: 10px;">
                                <div style="height:530px;width:295px;border-radius: 10px;" class="text-center">
                                    <div style="height: 50px;width: 100%;background-color: rgb(49,46,51);border-top-right-radius: 10px;border-top-left-radius: 10px;"
                                         class="text-center">
                                        <p style="color: #fff;line-height: 50px;">linksteady</p>
                                    </div>
                                    <div id='wxChat' style="height: 300px;width: 100%;background-color: rgb(235,235,235);border-bottom-left-radius: 10px;border-bottom-right-radius: 10px">
                                        <div class="send" id="preview">
                                            <div class="arrow"></div>
                                            <span id="wxPreview">请输入消息内容</span>
                                        </div>

                                        <div id="chatDiv">
<!-- 消息预览，JS拼接了代码，此处为不需要-->
<!--                                            <div style="overflow:hidden;">-->
<!--                                                <div class="send" style="position: relative;margin-top: 200px;">-->
<!--                                                    <div class="arrow"></div>-->
<!--                                                    <p class="h5">送你一张五元券</p>-->
<!--                                                    <div style=" width: 230px;height: 170px;background-image: url(https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1599631614507&di=8bb19956eab55733b1e8d9b7ae75d1ea&imgtype=0&src=http%3A%2F%2Fpicture.ik123.com%2Fuploads%2Fallimg%2F160812%2F4-160Q2151302.jpg);-webkit-background-size:cover;-moz-background-size: cover;-o-background-size: cover;background-size: cover;"></div>-->
<!--                                                    <hr style="background: #b0b0b0;margin-top: 6px;margin-bottom: 6px;"/>-->
<!--                                                    <p style="margin-bottom: 0px;color: #838383"><i class="fa fa-skyatlas" style="color: #1296db"></i>&nbsp;小程序</p>-->
<!--                                                </div>-->
<!--                                            </div>-->
                                        </div>
                                    </div>
<!--                                    <div style="height: auto;width: 100%;background-color: rgb(235,235,235);border-bottom-left-radius: 10px;border-bottom-right-radius: 10px; padding-bottom: 25px;">-->
<!--                                        <div class="send" id="preview">-->
<!--                                            <div class="arrow"></div>-->
<!--                                            <span id="wxPreview" style="width:auto; display:block; text-align:left;">请输入欢迎语内容</span>-->
<!--                                        </div>-->

<!--                                        <div id="chatDiv">-->
<!--                                            <div style="overflow:hidden;">-->
<!--                                                <div class="send" style="position: relative;margin-top: 200px;">-->
<!--                                                    <div class="arrow"></div>-->
<!--                                                    <p class="h5">送你一张五元券</p>-->
<!--                                                    <div style=" width: 230px;height: 170px;background-image: url(https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1599631614507&di=8bb19956eab55733b1e8d9b7ae75d1ea&imgtype=0&src=http%3A%2F%2Fpicture.ik123.com%2Fuploads%2Fallimg%2F160812%2F4-160Q2151302.jpg);-webkit-background-size:cover;-moz-background-size: cover;-o-background-size: cover;background-size: cover;"></div>-->
<!--                                                    <hr style="background: #b0b0b0;margin-top: 6px;margin-bottom: 6px;"/>-->
<!--                                                    <p style="margin-bottom: 0px;color: #838383"><i class="fa fa-skyatlas" style="color: #1296db"></i>&nbsp;小程序</p>-->
<!--                                                </div>-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
<div class="modal fade" id="couponModal" data-keyboard="false" data-backdrop="static" tabindex="-1">
    <div class="modal-dialog" style="width: 65%;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h5 class="modal-title pull-left">查看建议</h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12"
                         style="width:96%;height:91px;border:dashed 1px #48b0f7;padding-top: 3px;padding-bottom: 3px;margin-left: 15px;">
                        <p class="h6" style="border-bottom: #48b0f7 1px dashed;padding: 5px;">用户链路</p>
                        <button class="btn btn-round btn-sm btn-secondary m-t-5">以券为利益点引导用户添加好友</button>
                        <i class="fa fa-arrow-right"></i>
                        <button class="btn btn-round btn-sm btn-secondary m-t-5">用户添加好友后自动派发领券页</button>
                        <i class="fa fa-arrow-right"></i>
                        <button class="btn btn-round btn-sm btn-secondary m-t-5">用户点击领券页进入商城完成商品购买</button>
                    </div>
                </div>
                <div class="row m-t-10">
                    <div class="col-sm-12">
                        <div class="btn-group-sm" id="toolbar" role="group">
                            <a class="btn btn-primary btn-edit" id="btn_insight">
                                <i class="fa fa-cog"></i> 智能优惠券
                            </a>
                            <a class="btn btn-primary btn-view" onclick="addCouponModal()">
                                <i class="fa fa-save"></i> 新增优惠券
                            </a>
                            <a class="btn btn-warning btn-view" onclick="beforeUpdateCoupon()">
                                <i class="fa fa-edit"></i> 编辑优惠券
                            </a>
                            <a class="btn btn-danger btn-view" onclick="deleteCoupon()">
                                <i class="fa fa-trash"></i> 删除优惠券
                            </a>
                        </div>
                    </div>
                </div>
                <div class="row m-t-10">
                    <div class="col-sm-12 table-striped">
                        <table id="couponDataTable" class="table table-striped table-bordered text-nowrap"></table>
                    </div>
                </div>
                <div class="modal-footer m-t-10">
                    <button type="button" class="btn btn-primary btn-sm" onclick="setCoupon()">确定</button>
                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="productModal" data-keyboard="false" data-backdrop="static" tabindex="-1">
    <div class="modal-dialog" style="width: 65%;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h5 class="modal-title pull-left">查看建议</h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12"
                         style="width:96%;height:91px;border:dashed 1px #48b0f7;padding-top: 3px;padding-bottom: 3px;margin-left: 15px;">
                        <p class="h6" style="border-bottom: #48b0f7 1px dashed;padding: 5px;">用户链路</p>
                        <button class="btn btn-round btn-sm btn-secondary m-t-5">以券为利益点引导用户添加好友</button>
                        <i class="fa fa-arrow-right"></i>
                        <button class="btn btn-round btn-sm btn-secondary m-t-5">用户添加好友后自动派发商品页&将券打入用户账户</button>
                        <i class="fa fa-arrow-right"></i>
                        <button class="btn btn-round btn-sm btn-secondary m-t-5">留手机号完成商品购买</button>
                    </div>
                </div>
                <div class="row m-t-10">
                    <div class="col-sm-12">
                        <div class="btn-group-sm" role="group">
                            <a class="btn btn-primary btn-edit">
                                <i class="fa fa-cog"></i> 智能商品页
                            </a>
                            <a class="btn btn-primary btn-view" onclick="addProductModal()">
                                <i class="fa fa-save"></i> 新增商品页
                            </a>
                            <a class="btn btn-warning btn-view" onclick="beforeUpdateProduct()">
                                <i class="fa fa-edit"></i> 编辑商品页
                            </a>
                            <a class="btn btn-danger btn-view" onclick="deleteProduct()">
                                <i class="fa fa-trash"></i> 删除商品页
                            </a>
                        </div>
                    </div>
                </div>
                <div class="row m-t-10">
                    <div class="col-sm-12 table-striped">
                        <table id="productDataTable" class="table table-striped table-bordered text-nowrap"></table>
                    </div>
                </div>
                <div class="modal-footer m-t-10">
                    <button type="button" class="btn btn-primary btn-sm" onclick="setProduct()">确定</button>
                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addProductModal" data-keyboard="false" data-backdrop="static" tabindex="-1">
    <div class="modal-dialog" style="width: 65%;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h5 class="modal-title pull-left" id="addProductTitle">新增商品</h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="modal-body">
                            <form class="form-horizontal" id="addProductForm" novalidate="novalidate">
                                <div class="form-group mg-stop">
                                    <label class="col-md-3 control-label">商品ID：</label>
                                    <div class="col-md-8 input-group">
                                        <input class="form-control" type="text" id="productId" name="productId"/>
                                    </div>
                                </div>
                                <div class="form-group mg-stop">
                                    <label class="col-md-3 control-label">商品名称：</label>
                                    <div class="col-md-8 input-group">
                                        <input class="form-control" type="text" id="productName" name="productName">
                                    </div>
                                </div>
                                <div class="form-group mg-stop">
                                    <label class="col-md-3 control-label">售价(元)：</label>
                                    <div class="col-md-8 input-group">
                                        <input class="form-control" type="text" id="price" name="price">
                                    </div>
                                </div>
                                <div class="form-group mg-stop">
                                    <label class="col-md-3 control-label">商品类型：</label>
                                    <div class="col-md-8 input-group">
                                        <input class="form-control" type="text" id="productType" name="productType">
                                    </div>
                                </div>
                                <div class="form-group mg-stop">
                                    <label class="col-md-3 control-label">地址：</label>
                                    <div class="col-md-8 input-group">
                                        <input class="form-control" type="text" id="productUrl" name="productUrl">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer m-t-10">
                    <button type="button" class="btn btn-primary btn-sm" onclick="saveProductData()" id="saveProductBtn">确定</button>
                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addCouponModal" data-keyboard="false" data-backdrop="static" tabindex="-1">
    <div class="modal-dialog" style="width: 65%;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h5 class="modal-title pull-left" id="addCouponTitle">新增优惠券</h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="modal-body">
                            <form class="form-horizontal" id="addCouponForm" novalidate="novalidate">
                                <input type="hidden" id="couponId" name="couponId"/>
                                <div class="form-group mg-stop">
                                    <label class="col-md-3 control-label">门槛（元）：</label>
                                    <div class="col-md-8 input-group">
                                        <input class="form-control" type="text" id="couponDeno" name="couponDeno">
                                    </div>
                                </div>
                                <div class="form-group mg-stop">
                                    <label class="col-md-3 control-label">面额（元）：</label>
                                    <div class="col-md-8 input-group">
                                        <input class="form-control" type="text" id="couponThreshold" name="couponThreshold">
                                    </div>
                                </div>
                                <div class="form-group mg-stop">
                                    <label class="col-md-3 control-label">优惠券地址：</label>
                                    <div class="col-md-8 input-group">
                                        <input class="form-control" type="text" id="couponUrl" name="couponUrl">
                                    </div>
                                </div>
                                <div class="form-group mg-stop">
                                    <label class="col-md-3 control-label">有效截止日期：</label>
                                    <div class="col-md-8 input-group">
                                        <input class="form-control" type="text" id="endDate" name="endDate">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer m-t-10">
                    <button type="button" class="btn btn-primary btn-sm" onclick="saveCouponData()" id="saveCouponBtn">确定</button>
                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>
</div>
<th:block th:include="common/include::footer"/>
<th:block th:include="common/include::datepicker-js" />
<th:block th:include="common/include::perfect-scrollbar"/>
<th:block th:include="common/include::jquery-validate-js"/>
<th:block th:include="common/include::common-js"/>
<th:block th:include="common/include::bootstrap-table-js"/>
<th:block th:include="common/include::jquery-confirm-js"/>
<script data-th-src="@{/js/app/operate/welcome/add.js}"></script>
</body>
</html>
