<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="edge" />
    <title>用户运营系统</title>
    <link rel="shortcut icon" type="image/png" th:href="@{/img/favicon.ico}" />
    <link rel="stylesheet" data-th-href="@{/css/bootstrap.min.css}"/>
    <link rel="stylesheet" data-th-href="@{/css/materialdesignicons.min.css}"/>
    <link rel="stylesheet" data-th-href="@{/css/animate.css}"/>
    <link rel="stylesheet" data-th-href="@{/plugins/bootstrap-table/bootstrap-table.css}">
    <link rel="stylesheet" data-th-href="@{/css/style.min.css}"/>
</head>

<body>
<!-- 公共组件 -->
<div data-th-include="common/common"></div>
<div class="lyear-layout-web">
    <div class="lyear-layout-container">
        <!-- 左侧导航 -->
        <div data-th-include="common/aside"></div>
        <!-- 头部信息 -->
        <div data-th-include="common/header"></div>
        <!-- 页面主要内容 -->
        <main class="lyear-layout-content">
            <div class="container-fluid">
                <div class="card">
                    <div class="card-header">
                        <h4>诊断详情</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12">
                                <div data-th-include="operate/diagnosis/progress"></div>
                            </div>
                        </div>

                        <!--图标区-->
                        <div class="row">
                            <div class="col-md-12">
                                <div th:include="operate/diagnosis/nodeChartModal"></div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 text-center">
                                <a class="btn btn-default" href="/page/diagnosis/list"><i class="mdi mdi-reply"></i>返回</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
<script data-th-src="@{/plugins/bootstrap-table/bootstrap-table.js}"></script>
<script data-th-src="@{/plugins/bootstrap-table/bootstrap-table-zh-CN.min.js}"></script>
<script data-th-src="@{/plugins/echarts/echarts.min.js}"></script>
<script data-th-src="@{/plugins/echarts/macarons.js}"></script>
<script data-th-src="@{/js/app/operate/diagnosis/template.js}"></script>
<script data-th-src="@{/js/app/operate/diagnosis/modal.js}"></script>
<script>
    var diagId = "[[${id}]]";
    var jm;

    $.post("/diag/getNodes", {diagId: diagId}, function (r) {
        jmInit(r.data);
    });

    function jmInit(data) {
        var mind = {
            "meta":{
                "name":"gmv_mind",
                "version":"0.2"
            },
            "format":"node_array",
            "data": data
        };
        var options = {
            container:'jsmind_container',
            editable:false,
            theme:'greensea',
            mode: "side"
        };
        jm = jsMind.show(options,mind);
        addEventListenerOfNode();
    }
    function addEventListenerOfNode() {
        // 注册鼠标右键事件
        $("jmnode").mousedown(function (event) {

            // 动态设置节点为选中状态，参考api的mousedown_handle实现
            var element = event.target;
            var nodeid = jm.view.get_binded_nodeid(element);
            if(!!nodeid) {
                jm.select_node(nodeid);
            }else {
                jm.select_clear();
            }

            var event = event || window.event;
            if(event.button == "2"){

            }else {
                nodeClick();
            }
        });
    }
</script>
</body>
</html>